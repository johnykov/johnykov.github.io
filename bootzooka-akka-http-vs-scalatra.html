<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <title>Performance akka-http vs scalatra :: johny&#39;s blog - Example site for hugo-theme-tailwind</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="Some time ago we changed how Bootzooka handles HTTP requests. My goal is to compare two great tools:
complete web framework scalatra 2.3.1 (latest stable) called by one of it&amp;rsquo;s project leaders a web toolkit akka-http 2.4.2 from a performance perspective. I find both of them very helpful but they work in different ways so the idea is to see how much that impacts the application and it&amp;rsquo;s users.
Whenever you buy a car - you look at its specification."
/>
<meta
  name="keywords"
  content="[keyword 1 keyword 2 keyword 3]"
/>
<meta name="robots" content="noodp" />
<meta property="og:title" content="Performance akka-http vs scalatra" />
<meta property="og:description" content="Some time ago we changed how Bootzooka handles HTTP requests. My goal is to compare two great tools:
complete web framework scalatra 2.3.1 (latest stable) called by one of it&rsquo;s project leaders a web toolkit akka-http 2.4.2 from a performance perspective. I find both of them very helpful but they work in different ways so the idea is to see how much that impacts the application and it&rsquo;s users.
Whenever you buy a car - you look at its specification." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://johnykov.github.io/bootzooka-akka-http-vs-scalatra.html" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-03-29T00:00:00+00:00" />
<meta property="article:modified_time" content="2016-03-29T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Performance akka-http vs scalatra"/>
<meta name="twitter:description" content="Some time ago we changed how Bootzooka handles HTTP requests. My goal is to compare two great tools:
complete web framework scalatra 2.3.1 (latest stable) called by one of it&rsquo;s project leaders a web toolkit akka-http 2.4.2 from a performance perspective. I find both of them very helpful but they work in different ways so the idea is to see how much that impacts the application and it&rsquo;s users.
Whenever you buy a car - you look at its specification."/>


<link rel="canonical" href="https://johnykov.github.io/bootzooka-akka-http-vs-scalatra.html" />

<link rel="shortcut icon" href="/favicon.ico" />
<link rel="stylesheet" href="/css/index.min.6b36fefec2ed9f418034c92a2410b3c6970c05de2c1fa6751ca7da1b786b6e4f.css">





<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-20629244-7', 'auto');
	
	ga('send', 'pageview');
}
</script>




  
</head>
<body class="flex flex-col min-h-screen w-full bg-slate-50 dark:bg-gray-800">
  <header class="flex flex-none justify-center z-10">
    <div class="flex flex-row gap justify-between w-full max-w-4xl lg:max-w-5xl h-12 mt-3">
  <div class="flex-none ml-2 md:ml-0">
    <a href="/" class="">
      <img class="h-12 w-12 rounded-full object-cover bg-gray-100" src="/blacksmith.jpg" alt="logo">
    </a>
  </div>
  <div class="flex-1"></div>
  <div class="flex-none">
    



<nav class="h-full static">
  <button id="navbar-menu-toggle" type="button" class="inline-flex items-center p-2 text-sm text-slate-800 dark:text-slate-200 rounded-lg md:hidden" aria-controls="navbar-menu" aria-expanded="false">
    <span class="sr-only">Open main menu</span>
    <i class="w-8 h-8">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-menu-2" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 6l16 0" />
  <path d="M4 12l16 0" />
  <path d="M4 18l16 0" />
</svg>

    </i>
  </button>
  <div class="absolute md:static top-16 left-0 right-0 z-50 hidden w-full md:block md:w-auto" id="navbar-menu">
    <ul class="flex flex-col mx-2 md:mx-0 md:flex-row md:border-0 rounded-sm md:rounded-full px-3 text-base font-medium text-slate-800 dark:text-slate-200 shadow-lg bg-white dark:bg-gray-600 shadow-slate-800/5 dark:shadow-slate-200/5 ring-1 ring-slate-900/5 dark:ring-slate-100/5">
    
        <li id="about" class="">
          <a class="block px-3 py-3 hover:text-emerald-600"
            href="/about/" title="About">About</a>
        </li>
      
    
        <li id="post" class="">
          <a class="block px-3 py-3 hover:text-emerald-600 text-emerald-600"
            href="/posts/" title="Post">Post</a>
        </li>
      
    
    </ul>
  </div>
</nav>


  </div>
  
  <div class="flex-none mx-1"></div>
  
  <div class="flex-none md:hidden">
    <a href=/search/ class="inline-flex items-center p-2 text-sm text-slate-800 dark:text-slate-200 rounded-lg" aria-controls="navbar-menu" aria-expanded="false">
      <span class="sr-only">Search</span>
      <i class="w-8 h-8">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
    <path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0" />
    <path d="M21 21l-6 -6" />
</svg>

      </i>
    </a>
  </div>
  <div class="darkmode-toggle flex flex-none mr-2 md:mr-0">
    <label for="darkmode-toggle" class="flex items-center px-3 cursor-pointer rounded-full bg-gray-100 dark:bg-gray-600" title="Toggle dark mode">
      <input name="darkmode-toggle" id="darkmode-toggle" type="checkbox" class="sr-only peer" aria-label="Toggle dark mode">
      <div class="group flex flex-row gap-1 justify-center h-8 px-1 rounded-full bg-white dark:bg-gray-700">
        <i class="h-6 w-6 flex-none rounded-full bg-yellow-400 place-self-center peer-checked:group-[]:invisible">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brightness-down" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
   <path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"></path>
   <path d="M12 5l0 .01"></path>
   <path d="M17 7l0 .01"></path>
   <path d="M19 12l0 .01"></path>
   <path d="M17 17l0 .01"></path>
   <path d="M12 19l0 .01"></path>
   <path d="M7 17l0 .01"></path>
   <path d="M5 12l0 .01"></path>
   <path d="M7 7l0 .01"></path>
</svg>

        </i>
        <i class="h-6 w-6 flex-none rounded-full place-self-center invisible peer-checked:group-[]:visible">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-moon-stars" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
   <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
   <path d="M17 4a2 2 0 0 0 2 2a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2a2 2 0 0 0 2 -2"></path>
   <path d="M19 11h2m-1 -1v2"></path>
</svg>

        </i>
      </div>
    </label>
  </div>
</div>

  </header>
  <main class="flex flex-auto justify-center">
    
<div class="w-full max-w-4xl lg:max-w-5xl">
  <div class="flex flex-col gap-y-3 p-6 mt-6 mx-2 md:mx-0 rounded-lg shadow-md bg-white dark:bg-gray-700">
    <h1 class="text-4xl font-semibold text-slate-800 dark:text-slate-100">
      <a href="/bootzooka-akka-http-vs-scalatra.html">Performance akka-http vs scalatra</a>
    </h1>

    
    


    <div class="flex flex-col gap-y-1 md:flex-row md:gap-y-0 md:gap-x-4 text-slate-500 dark:text-slate-300">
  
  
  <div class="flex flex-row text-base gap-x-1">
    <i class="h-6 w-6 flex-none">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
   <path d="M4 7a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12z"></path>
   <path d="M16 3v4"></path>
   <path d="M8 3v4"></path>
   <path d="M4 11h16"></path>
   <path d="M11 15h1"></path>
   <path d="M12 15v3"></path>
</svg>

    </i>
    <time datetime="2016-03-29T00:00:00&#43;00:00">
      2016-03-29
    </time>
  </div>

  <div class="flex flex-row text-base gap-x-1">
    <i class="h-6 w-6 flex-none">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hourglass-high" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
   <path d="M6.5 7h11"></path>
   <path d="M6 20v-2a6 6 0 1 1 12 0v2a1 1 0 0 1 -1 1h-10a1 1 0 0 1 -1 -1z"></path>
   <path d="M6 4v2a6 6 0 1 0 12 0v-2a1 1 0 0 0 -1 -1h-10a1 1 0 0 0 -1 1z"></path>
</svg>

    </i>
    <span>
      12 minutes to read
    </span>
  </div>
</div>


    
      
      <section class="prose prose-slate dark:prose-invert w-full max-w-4xl lg:max-w-5xl mt-6">
        <h2>Table of Contents</h2>
        <aside><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#brief-details-of-tested-tools-internals">Brief details of tested tools internals</a></li>
        <li><a href="#setup">Setup</a></li>
        <li><a href="#scenario">Scenario</a></li>
        <li><a href="#bootzooka-akka-http-version">Bootzooka akka-http version:</a></li>
        <li><a href="#bootzooka-scalatra-version">Bootzooka scalatra version:</a></li>
        <li><a href="#conclusion-after-scenario-setup-1">Conclusion after scenario setup 1</a></li>
      </ul>
    </li>
  </ul>
</nav></aside>
      </section>
      
    

    <article class="mt-6 w-full max-w-4xl lg:max-w-5xl prose prose-slate dark:prose-invert prose-quoteless post-content">
      <p><a href="https://softwaremill.com/bootzooka-akka-http-based/" target="_blank" rel="noopener">Some time ago we changed how Bootzooka handles HTTP requests.</a>
</p>
<p>My goal is to compare two great tools:</p>
<ol>
<li>complete web framework <a href="http://scalatra.org/" target="_blank" rel="noopener">scalatra 2.3.1</a>
 (latest stable)</li>
<li>called by one of it&rsquo;s project leaders a web toolkit <a href="http://doc.akka.io/docs/akka/2.4.2/scala/http/" target="_blank" rel="noopener">akka-http 2.4.2</a>
</li>
</ol>
<p>from a performance perspective. I find both of them very helpful but they work in different ways so the idea is to see how much that impacts the application and it&rsquo;s users.</p>
<p>Whenever you buy a car - you look at its specification. How fast it is, how amazing is the acceleration, how much petrol does it burn, how much load it can carry. I&rsquo;d like to know such metrics for tools I use to build web applications. Authors don&rsquo;t always publish such metrics and often Google doesn&rsquo;t find any. One such metric would be to compare benchmarks but there are none so let’s make a comparison.</p>
<p>From the Great Jez Humble&rsquo;s Continuous Delivery book, introduction to chapter 9, comes the definition of app performance:</p>
<blockquote>
<p>First of all, let’s clear up some confusion around the terms. We’ll use the same terminology as Michael Nygard.1 To paraphrase, performance is a measure of the time taken to process a single transaction, and can be measured either in isolation or under load. Throughput is the number of transactions a system can process in a given timespan. It is always limited by some bottleneck in the system.
The maximum throughput a system can sustain, for a given workload, while maintaining an acceptable response time for each individual request, is its capacity.
Customers are usually interested in throughput or capacity. In real life, “performance” is often used as a catch-all term; we will try to be rather more careful in this chapter.</p>
</blockquote>
<p>So I’ll try to find <strong>throughput</strong> and <strong>capacity</strong> for each versions of bootzooka.</p>
<h3 id="brief-details-of-tested-tools-internals">Brief details of tested tools internals</h3>
<p>The version of Scalatra that I&rsquo;ve tested works in synchronous &amp; blocking way while akka-http is by default &ldquo;reactive&rdquo; (asynchronous and non-blocking - ”reactive” trait might be easily lost when the implementation is blocking, so our code also needs to process asnychronously).</p>
<p>Scalatra is thread based, handling servlets and requires servlet container like jetty to run, it can delegate work to akka (from its docs, never tried this one), while akka-http is actor per request, doesn&rsquo;t require a container and writing actor model code is more natural pattern to follow in this case. Both have comparably pleasant DSLs for writing routes.</p>
<h3 id="setup">Setup</h3>
<p>Equipped with <a href="http://gatling.io" target="_blank" rel="noopener">gatling.io</a>
 (for generating fake traffic of user scenarios) and GCViewer (for watching a memory consumption, this is influenced by <a href="http://bandrzejczak.com/blog/2015/02/15/the-cost-of-the-garbage-collection/" target="_blank" rel="noopener">Bartek&rsquo;s post</a>
 to see if something spectacular is going on) I can measure what happens to my beloved framework (bootzooka) after switching web frameworks.</p>
<p>The test was performed on macbook pro, 2,5 GHz Intel Core i7 with 16 GB of ram.
I use default JVM flags what is Xss=1 MB (thread stack size) and InitialHeapSize ~ 260 MB and Xmx ~ 4 GB (note: heroku 1 dyno standard is 350 MB).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ java -XX:+PrintFlagsFinal version
</span></span><span style="display:flex;"><span>    uintx InitialHeapSize                          :<span style="color:#f92672">=</span> <span style="color:#ae81ff">268435456</span>                           
</span></span><span style="display:flex;"><span>    uintx MaxHeapSize                              :<span style="color:#f92672">=</span> <span style="color:#ae81ff">4294967296</span>                          
</span></span><span style="display:flex;"><span>    uintx MaxNewSize                               :<span style="color:#f92672">=</span> <span style="color:#ae81ff">1431306240</span>                          
</span></span><span style="display:flex;"><span>    uintx NewSize                                  :<span style="color:#f92672">=</span> <span style="color:#ae81ff">89128960</span>                            
</span></span><span style="display:flex;"><span>    uintx OldSize                                  :<span style="color:#f92672">=</span> <span style="color:#ae81ff">179306496</span>                           
</span></span><span style="display:flex;"><span>     intx ThreadStackSize                           <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span>                                
</span></span></code></pre></div><p>I’m running postgres 9.4 database locally with two separate schemas one for each scalatra and akka-http versions of bootzooka. So database configuration is same for each system. Gatling scenarios are being run on same local machine as bootzooka backends are deployed ( frontend is written in angular and it’s performance is fine). <strong>This configuration is a kind of “lab environment” where network latency and bandwidth doesn’t play any role, there is no data transmission over the wire what often is the main issue of webapp performance.</strong></p>
<ul>
<li><a href="https://github.com/softwaremill/bootzooka/tree/446255c88" target="_blank" rel="noopener">Scalatra bootzooka version (tag last-scalatra)</a>
</li>
<li><a href="https://github.com/softwaremill/bootzooka/tree/83827361" target="_blank" rel="noopener">Akka-http bootzooka version for this commit</a>
</li>
<li><a href="https://github.com/hanskoff/gatling-bootzooka" target="_blank" rel="noopener">Repository with simple scenario for the test</a>
</li>
</ul>
<h4 id="provisioning">Provisioning</h4>
<p>The <code>newbootzooka</code> schema is for akka-http bootzooka version and <code>oldbootzooka</code> schema is for scalatra.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>export DATABASE_URL<span style="color:#f92672">=</span>postgres://newbootzooka:newbootzooka@localhost:5432/newbootzooka <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>java -Dserver.port<span style="color:#f92672">=</span><span style="color:#ae81ff">8081</span> -Xloggc:newbootzooka-<span style="color:#66d9ef">$(</span>date +<span style="color:#e6db74">&#34;%Y-%m-%d_%H-%M-%S&#34;</span><span style="color:#66d9ef">)</span>.log <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-XX:+PrintGCDetails -XX:+PrintGCDateStamps -verbose:gc -jar new-bootzooka/bootzooka.jar
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>export DATABASE_URL<span style="color:#f92672">=</span>postgres://oldbootzooka:oldbootzooka@localhost:5432/oldbootzooka <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>java -Dembedded-jetty.port<span style="color:#f92672">=</span><span style="color:#ae81ff">8082</span> -Xloggc:oldbootzooka-<span style="color:#66d9ef">$(</span>date +<span style="color:#e6db74">&#34;%Y-%m-%d_%H-%M-%S&#34;</span><span style="color:#66d9ef">)</span>.log <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-XX:+PrintGCDetails -XX:+PrintGCDateStamps -verbose:gc -jar old-bootzooka/bootzooka.jar
</span></span></code></pre></div><h3 id="scenario">Scenario</h3>
<p>It’s very basic as bootzooka doesn’t do complicated stuff. In the first step user goes to <code>/</code>, waits for http 200 code and in second sends post request (to <code>/api/users/register</code>) to register himself and awaits for <code>success</code> string in response body.</p>
<h4 id="scenario-setup-1">Scenario setup 1</h4>
<p>Throwing at each system 200 users at once just to see what happens <a href="https://github.com/hanskoff/gatling-bootzooka/blob/master/src/test/scala/pl/jan/BootzookaRegistrationScn.scala" target="_blank" rel="noopener">BootzookaRegistrationScn</a>
</p>
<h3 id="bootzooka-akka-http-version">Bootzooka akka-http version:</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./gradlew -Dserver.port<span style="color:#f92672">=</span><span style="color:#ae81ff">8081</span> loadTest
</span></span></code></pre></div><p>First round results:</p>
<pre tabindex="0"><code>    ================================================================================
    ---- Global Information --------------------------------------------------------
    &gt; request count                                        400 (OK=387    KO=13    )
    &gt; min response time                                     18 (OK=18     KO=111   )
    &gt; max response time                                   3991 (OK=3991   KO=1227  )
    &gt; mean response time                                  1364 (OK=1397   KO=403   )
    &gt; std deviation                                       1226 (OK=1232   KO=331   )
    &gt; response time 50th percentile                        957 (OK=1103   KO=333   )
    &gt; response time 75th percentile                       2445 (OK=2446   KO=552   )
    &gt; mean requests/sec                                 79.586 (OK=77     KO=2.587 )
    ---- Response Time Distribution ------------------------------------------------
    &gt; t &lt; 800 ms                                           170 ( 43%)
    &gt; 800 ms &lt; t &lt; 1200 ms                                  33 (  8%)
    &gt; t &gt; 1200 ms                                          184 ( 46%)
    &gt; failed                                                13 (  3%)
    ---- Errors --------------------------------------------------------------------
    &gt; java.net.ConnectException: Connection reset by peer                13 (100.0%)
    ================================================================================
</code></pre><p>You can see there was 400 requests as each user makes 2 requests.
There were 13 timeouts, so maybe because of JIT compilation, let&rsquo;s run test a second round:</p>
<pre tabindex="0"><code>    ================================================================================
    ---- Global Information --------------------------------------------------------
    &gt; request count                                        400 (OK=400    KO=0     )
    &gt; min response time                                      7 (OK=7      KO=-     )
    &gt; max response time                                    679 (OK=679    KO=-     )
    &gt; mean response time                                   193 (OK=193    KO=-     )
    &gt; std deviation                                        215 (OK=215    KO=-     )
    &gt; response time 50th percentile                         45 (OK=45     KO=-     )
    &gt; response time 75th percentile                        404 (OK=404    KO=-     )
    &gt; mean requests/sec                                171.969 (OK=171.969 KO=-     )
    ---- Response Time Distribution ------------------------------------------------
    &gt; t &lt; 800 ms                                           400 (100%)
    &gt; 800 ms &lt; t &lt; 1200 ms                                   0 (  0%)
    &gt; t &gt; 1200 ms                                            0 (  0%)
    &gt; failed                                                 0 (  0%)
    ================================================================================
</code></pre><p>Looks good, how about doubling number to 400 users at once, third round:</p>
<pre tabindex="0"><code>    ================================================================================
    ---- Global Information --------------------------------------------------------
    &gt; request count                                        800 (OK=800    KO=0     )
    &gt; min response time                                      7 (OK=7      KO=-     )
    &gt; max response time                                   1443 (OK=1443   KO=-     )
    &gt; mean response time                                   440 (OK=440    KO=-     )
    &gt; std deviation                                        471 (OK=471    KO=-     )
    &gt; response time 50th percentile                        200 (OK=200    KO=-     )
    &gt; response time 75th percentile                        920 (OK=920    KO=-     )
    &gt; mean requests/sec                                212.993 (OK=212.993 KO=-     )
    ---- Response Time Distribution ------------------------------------------------
    &gt; t &lt; 800 ms                                           541 ( 68%)
    &gt; 800 ms &lt; t &lt; 1200 ms                                 183 ( 23%)
    &gt; t &gt; 1200 ms                                           76 ( 10%)
    &gt; failed                                                 0 (  0%)
    ================================================================================
</code></pre><p>No failed requests, mean req/sec ~ 212. Let&rsquo;s double users for forth round:</p>
<pre tabindex="0"><code>    ================================================================================
    ---- Global Information --------------------------------------------------------
    &gt; request count                                       1600 (OK=1565   KO=35    )
    &gt; min response time                                      4 (OK=4      KO=159   )
    &gt; max response time                                   4167 (OK=4167   KO=1625  )
    &gt; mean response time                                  1016 (OK=1016   KO=991   )
    &gt; std deviation                                       1032 (OK=1041   KO=428   )
    &gt; response time 50th percentile                        896 (OK=895    KO=1285  )
    &gt; response time 75th percentile                       1515 (OK=1519   KO=1288  )
    &gt; mean requests/sec                                228.571 (OK=223.571 KO=5     )
    ---- Response Time Distribution ------------------------------------------------
    &gt; t &lt; 800 ms                                           720 ( 45%)
    &gt; 800 ms &lt; t &lt; 1200 ms                                 157 ( 10%)
    &gt; t &gt; 1200 ms                                          688 ( 43%)
    &gt; failed                                                35 (  2%)
    ---- Errors --------------------------------------------------------------------
    &gt; java.net.ConnectException: Connection reset by peer                35 (100.0%)
    ================================================================================
</code></pre><p>2% of failed requests but no error in logs (maybe we don&rsquo;t handle that case yet). And in logs I&rsquo;ve found:</p>
<pre tabindex="0"><code>java.sql.SQLTimeoutException: Timeout after 1015ms of waiting for a connection.
</code></pre><p>and more:</p>
<p>13:53:45.304 [main-akka.actor.default-dispatcher-82] ERROR c.s.b.Main$$anon$1 - Exception during client request processing: Task slick.backend.DatabaseComponent$DatabaseDef$$anon$2@71688eb2 rejected from java.util.concurrent.ThreadPoolExecutor@4131e49e[Running, pool size = 20, active threads = 20, queued tasks = 1000, completed tasks = 4067]</p>
<p>Let&rsquo;s repeat, same setup, fifth round:</p>
<pre tabindex="0"><code>    ================================================================================
    ---- Global Information --------------------------------------------------------
    &gt; request count                                       1600 (OK=1600   KO=0     )
    &gt; min response time                                      4 (OK=4      KO=-     )
    &gt; max response time                                   1905 (OK=1905   KO=-     )
    &gt; mean response time                                   378 (OK=378    KO=-     )
    &gt; std deviation                                        631 (OK=631    KO=-     )
    &gt; response time 50th percentile                         57 (OK=57     KO=-     )
    &gt; response time 75th percentile                        300 (OK=300    KO=-     )
    &gt; mean requests/sec                                225.384 (OK=225.384 KO=-     )
    ---- Response Time Distribution ------------------------------------------------
    &gt; t &lt; 800 ms                                          1310 ( 82%)
    &gt; 800 ms &lt; t &lt; 1200 ms                                  23 (  1%)
    &gt; t &gt; 1200 ms                                          267 ( 17%)
    &gt; failed                                                 0 (  0%)
    ================================================================================
</code></pre><p>No failed requests this time,75th percentile means: 75% of requests handled within below 300 milliseconds.</p>
<h3 id="bootzooka-scalatra-version">Bootzooka scalatra version:</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./gradlew -Dserver.port<span style="color:#f92672">=</span><span style="color:#ae81ff">8082</span> loadTest
</span></span></code></pre></div><p>First round:</p>
<pre tabindex="0"><code>    ================================================================================
    ---- Global Information --------------------------------------------------------
    &gt; request count                                        400 (OK=284    KO=116   )
    &gt; min response time                                     61 (OK=61     KO=10486 )
    &gt; max response time                                  11823 (OK=11823  KO=11805 )
    &gt; mean response time                                  5800 (OK=3502   KO=11426 )
    &gt; std deviation                                       5640 (OK=5156   KO=199   )
    &gt; response time 50th percentile                       1747 (OK=224    KO=11447 )
    &gt; response time 75th percentile                      11470 (OK=11334  KO=11571 )
    &gt; mean requests/sec                                 31.464 (OK=22.339 KO=9.125 )
    ---- Response Time Distribution ------------------------------------------------
    &gt; t &lt; 800 ms                                           200 ( 50%)
    &gt; 800 ms &lt; t &lt; 1200 ms                                   0 (  0%)
    &gt; t &gt; 1200 ms                                           84 ( 21%)
    &gt; failed                                               116 ( 29%)
    ---- Errors --------------------------------------------------------------------
    &gt; regex(success).find(0).exists, found nothing                      116 (100.0%)
    ================================================================================
</code></pre><p>116 failed request, same case let&rsquo;s give a JIT a chance. Second round:</p>
<pre tabindex="0"><code>    ================================================================================
    ---- Global Information --------------------------------------------------------
    &gt; request count                                        400 (OK=327    KO=73    )
    &gt; min response time                                      1 (OK=1      KO=4298  )
    &gt; max response time                                   5015 (OK=5015   KO=4773  )
    &gt; mean response time                                  2016 (OK=1449   KO=4556  )
    &gt; std deviation                                       2279 (OK=2143   KO=101   )
    &gt; response time 50th percentile                         67 (OK=53     KO=4576  )
    &gt; response time 75th percentile                       4623 (OK=4583   KO=4627  )
    &gt; mean requests/sec                                 67.261 (OK=54.986 KO=12.275)
    ---- Response Time Distribution ------------------------------------------------
    &gt; t &lt; 800 ms                                           222 ( 56%)
    &gt; 800 ms &lt; t &lt; 1200 ms                                   6 (  2%)
    &gt; t &gt; 1200 ms                                           99 ( 25%)
    &gt; failed                                                73 ( 18%)
    ---- Errors --------------------------------------------------------------------
    &gt; regex(success).find(0).exists, found nothing                       73 (100.0%)
    ================================================================================
</code></pre><p>73 failed, ok it&rsquo;s better then 116 but let&rsquo;s keep it warming. Third round:</p>
<pre tabindex="0"><code>    ================================================================================
    ---- Global Information --------------------------------------------------------
    &gt; request count                                        400 (OK=357    KO=43    )
    &gt; min response time                                      1 (OK=1      KO=3261  )
    &gt; max response time                                   3929 (OK=3929   KO=3667  )
    &gt; mean response time                                  1505 (OK=1269   KO=3463  )
    &gt; std deviation                                       1626 (OK=1563   KO=109   )
    &gt; response time 50th percentile                        291 (OK=250    KO=3468  )
    &gt; response time 75th percentile                       3507 (OK=3462   KO=3553  )
    &gt; mean requests/sec                                  80.89 (OK=72.194 KO=8.696 )
    ---- Response Time Distribution ------------------------------------------------
    &gt; t &lt; 800 ms                                           229 ( 57%)
    &gt; 800 ms &lt; t &lt; 1200 ms                                   9 (  2%)
    &gt; t &gt; 1200 ms                                          119 ( 30%)
    &gt; failed                                                43 ( 11%)
    ---- Errors --------------------------------------------------------------------
    &gt; regex(success).find(0).exists, found nothing                       43 (100.0%)
    ================================================================================
</code></pre><p>43 failed, number is decreasing but we see mean 80 req/sec with 11% of failures. Forth round:</p>
<pre tabindex="0"><code>    ================================================================================
    ---- Global Information --------------------------------------------------------
    &gt; request count                                        400 (OK=339    KO=61    )
    &gt; min response time                                      1 (OK=1      KO=2005  )
    &gt; max response time                                   5830 (OK=5830   KO=5528  )
    &gt; mean response time                                  2162 (OK=1648   KO=5021  )
    &gt; std deviation                                       2601 (OK=2466   KO=957   )
    &gt; response time 50th percentile                         61 (OK=21     KO=5370  )
    &gt; response time 75th percentile                       5412 (OK=5318   KO=5451  )
    &gt; mean requests/sec                                 58.651 (OK=49.707 KO=8.944 )
    ---- Response Time Distribution ------------------------------------------------
    &gt; t &lt; 800 ms                                           230 ( 58%)
    &gt; 800 ms &lt; t &lt; 1200 ms                                   7 (  2%)
    &gt; t &gt; 1200 ms                                          102 ( 26%)
    &gt; failed                                                61 ( 15%)
    ---- Errors --------------------------------------------------------------------
    &gt; regex(success).find(0).exists, found nothing                       61 (100.0%)
    ================================================================================
</code></pre><p>61 failed, looks like won&rsquo;t be better, however let&rsquo;s double users to compare it with akka-http system. Fifth round:</p>
<p>400 requests at once:</p>
<pre tabindex="0"><code>    ================================================================================
    ---- Global Information --------------------------------------------------------
    &gt; request count                                        800 (OK=572    KO=228   )
    &gt; min response time                                      1 (OK=1      KO=1993  )
    &gt; max response time                                  14464 (OK=14464  KO=14065 )
    &gt; mean response time                                  5533 (OK=2370   KO=13468 )
    &gt; std deviation                                       6667 (OK=5087   KO=1723  )
    &gt; response time 50th percentile                        116 (OK=35     KO=13728 )
    &gt; response time 75th percentile                      13715 (OK=144    KO=13827 )
    &gt; mean requests/sec                                 50.614 (OK=36.189 KO=14.425)
    ---- Response Time Distribution ------------------------------------------------
    &gt; t &lt; 800 ms                                           458 ( 57%)
    &gt; 800 ms &lt; t &lt; 1200 ms                                   5 (  1%)
    &gt; t &gt; 1200 ms                                          109 ( 14%)
    &gt; failed                                               228 ( 29%)
    ---- Errors --------------------------------------------------------------------
    &gt; regex(success).find(0).exists, found nothing                      228 (100.0%)
    ================================================================================
</code></pre><p>50 mean req/sec with 29% of failed and in app logs I see:</p>
<pre tabindex="0"><code>java.sql.SQLTimeoutException: Timeout after 1003ms of waiting for a connection.
</code></pre><h4 id="memory-usage">Memory usage</h4>
<p>In both cases, memory usage is comparable, I saw same 99.97% of jvm code throughput and even almost same number of GC pauses. I have two files but nothing spectacular here. The upper window is akka-http bootzooka version the lower is scalatra version.</p>
<p><div class="not-prose">
<figure>
    <img src="/img/gcviewer.jpg"
      alt="GCviewer bootzooka comparision" 
      loading="lazy"
    >
  </figure></div>
</p>
<ul>
<li>newjvm-2016-03-29_15-11-42.log</li>
<li>oldjvm-2016-03-29_15-33-13.log</li>
</ul>
<h3 id="conclusion-after-scenario-setup-1">Conclusion after scenario setup 1</h3>
<p>This first scenario setup is naive and should show &ldquo;something&rdquo; and that is <code>akka-http app behaves better than scalatra</code> and continue to operate while getting bigger traffic too. Akka-http stops responding under much bigger load 800 users vs scalatra 200 users (mean 225 req/sec vs 50-80req/sec). It looks like akka-http version has better default configuration (thread pool size) and integrates well with <a href="http://slick.typesafe.com/" target="_blank" rel="noopener">slick</a>
 (functional relational mapping tool) and hikari-cp (tool that managed database connection pool) which overall handles resources in more efficient way.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h4 id="comparison-of-second-round-of-both-frameworks">Comparison of second round of both frameworks:</h4>
<p>For comparison I&rsquo;ve used <a href="https://github.com/nuxeo/gatling-report" target="_blank" rel="noopener">gatling-reports</a>
 and the <a href="https://github.com/nuxeo/gatling-report#output-csv-stats" target="_blank" rel="noopener">legend</a>
.</p>
<table>
<thead>
<tr>
<th style="text-align:center">simulation</th>
<th style="text-align:center">duration</th>
<th style="text-align:center">successCount</th>
<th style="text-align:center">errorCount</th>
<th style="text-align:center">min</th>
<th style="text-align:center">p50</th>
<th style="text-align:center">p95</th>
<th style="text-align:center">p99</th>
<th style="text-align:center">max</th>
<th style="text-align:center">avg</th>
<th style="text-align:center">stddev</th>
<th style="text-align:center">requestPerSecond</th>
<th style="text-align:center">apdex</th>
<th style="text-align:center">rating</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">akka-http</td>
<td style="text-align:center">1.98</td>
<td style="text-align:center">400</td>
<td style="text-align:center">0</td>
<td style="text-align:center">4</td>
<td style="text-align:center">43</td>
<td style="text-align:center">581</td>
<td style="text-align:center">678</td>
<td style="text-align:center">679</td>
<td style="text-align:center">191.2</td>
<td style="text-align:center">217</td>
<td style="text-align:center">201.71</td>
<td style="text-align:center">1</td>
<td style="text-align:center">Excellent</td>
</tr>
<tr>
<td style="text-align:center">scalatra</td>
<td style="text-align:center">5.48</td>
<td style="text-align:center">327</td>
<td style="text-align:center">73</td>
<td style="text-align:center">0</td>
<td style="text-align:center">65</td>
<td style="text-align:center">4901</td>
<td style="text-align:center">4984</td>
<td style="text-align:center">5015</td>
<td style="text-align:center">2014.55</td>
<td style="text-align:center">2284</td>
<td style="text-align:center">59.73</td>
<td style="text-align:center">0.79</td>
<td style="text-align:center">Fair</td>
</tr>
</tbody>
</table>
<ul>
<li>duration = seconds</li>
<li>succesCount = number of requests</li>
<li>min, p50, p95, p99, max, avg, stddev = miliseconds</li>
</ul>
<p>errors
<div class="not-prose">
<figure>
    <img src="/img/secondErrors.jpg"
      alt="image alt" 
      loading="lazy"
    >
  </figure></div>

duration
<div class="not-prose">
<figure>
    <img src="/img/secondDuration.jpg"
      alt="image alt" 
      loading="lazy"
    >
  </figure></div>

throughput
<div class="not-prose">
<figure>
    <img src="/img/secondRps.jpg"
      alt="image alt" 
      loading="lazy"
    >
  </figure></div>
</p>
<h4 id="comparison-of-best-runs-for-200-users">Comparison of best runs for 200 users:</h4>
<table>
<thead>
<tr>
<th style="text-align:center">simulation</th>
<th style="text-align:center">duration</th>
<th style="text-align:center">successCount</th>
<th style="text-align:center">errorCount</th>
<th style="text-align:center">min</th>
<th style="text-align:center">p50</th>
<th style="text-align:center">p95</th>
<th style="text-align:center">p99</th>
<th style="text-align:center">max</th>
<th style="text-align:center">avg</th>
<th style="text-align:center">stddev</th>
<th style="text-align:center">requestPerSecond</th>
<th style="text-align:center">apdex</th>
<th style="text-align:center">rating</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">akka-http</td>
<td style="text-align:center">1.98</td>
<td style="text-align:center">400</td>
<td style="text-align:center">0</td>
<td style="text-align:center">4</td>
<td style="text-align:center">43</td>
<td style="text-align:center">581</td>
<td style="text-align:center">678</td>
<td style="text-align:center">679</td>
<td style="text-align:center">191.2</td>
<td style="text-align:center">217</td>
<td style="text-align:center">201.71</td>
<td style="text-align:center">1</td>
<td style="text-align:center">Excellent</td>
</tr>
<tr>
<td style="text-align:center">scalatra</td>
<td style="text-align:center">4.49</td>
<td style="text-align:center">357</td>
<td style="text-align:center">43</td>
<td style="text-align:center">0</td>
<td style="text-align:center">259</td>
<td style="text-align:center">3770</td>
<td style="text-align:center">3869</td>
<td style="text-align:center">3928</td>
<td style="text-align:center">1473.31</td>
<td style="text-align:center">1654</td>
<td style="text-align:center">79.49</td>
<td style="text-align:center">0.8</td>
<td style="text-align:center">Fair</td>
</tr>
</tbody>
</table>
<h4 id="comparison-for-400-users">Comparison for 400 users:</h4>
<table>
<thead>
<tr>
<th style="text-align:center">simulation</th>
<th style="text-align:center">duration</th>
<th style="text-align:center">successCount</th>
<th style="text-align:center">errorCount</th>
<th style="text-align:center">min</th>
<th style="text-align:center">p50</th>
<th style="text-align:center">p95</th>
<th style="text-align:center">p99</th>
<th style="text-align:center">max</th>
<th style="text-align:center">avg</th>
<th style="text-align:center">stddev</th>
<th style="text-align:center">requestPerSecond</th>
<th style="text-align:center">apdex</th>
<th style="text-align:center">rating</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">akka-http</td>
<td style="text-align:center">3.41</td>
<td style="text-align:center">800</td>
<td style="text-align:center">0</td>
<td style="text-align:center">4</td>
<td style="text-align:center">199</td>
<td style="text-align:center">1390</td>
<td style="text-align:center">1438</td>
<td style="text-align:center">1443</td>
<td style="text-align:center">436.42</td>
<td style="text-align:center">474</td>
<td style="text-align:center">234.33</td>
<td style="text-align:center">1</td>
<td style="text-align:center">Excellent</td>
</tr>
<tr>
<td style="text-align:center">scalatra</td>
<td style="text-align:center">15.33</td>
<td style="text-align:center">572</td>
<td style="text-align:center">228</td>
<td style="text-align:center">0</td>
<td style="text-align:center">111</td>
<td style="text-align:center">14156</td>
<td style="text-align:center">14398</td>
<td style="text-align:center">14464</td>
<td style="text-align:center">5529.42</td>
<td style="text-align:center">6674</td>
<td style="text-align:center">37.3</td>
<td style="text-align:center">0.59</td>
<td style="text-align:center">Poor</td>
</tr>
</tbody>
</table>
<p>errors
<div class="not-prose">
<figure>
    <img src="/img/finalErrors.jpg"
      alt="image alt" 
      loading="lazy"
    >
  </figure></div>

duration
<div class="not-prose">
<figure>
    <img src="/img/finalDuration.jpg"
      alt="image alt" 
      loading="lazy"
    >
  </figure></div>

throughput
<div class="not-prose">
<figure>
    <img src="/img/finalRps.jpg"
      alt="image alt" 
      loading="lazy"
    >
  </figure></div>
</p>
<h4 id="comparison-for-800-users-where-akka-http-started-to-have-a-problems">Comparison for 800 users (where akka-http started to have a problems):</h4>
<table>
<thead>
<tr>
<th style="text-align:center">simulation</th>
<th style="text-align:center">duration</th>
<th style="text-align:center">successCount</th>
<th style="text-align:center">errorCount</th>
<th style="text-align:center">min</th>
<th style="text-align:center">p50</th>
<th style="text-align:center">p95</th>
<th style="text-align:center">p99</th>
<th style="text-align:center">max</th>
<th style="text-align:center">avg</th>
<th style="text-align:center">stddev</th>
<th style="text-align:center">requestPerSecond</th>
<th style="text-align:center">apdex</th>
<th style="text-align:center">rating</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">akka-http</td>
<td style="text-align:center">8.69</td>
<td style="text-align:center">1564</td>
<td style="text-align:center">36</td>
<td style="text-align:center">4</td>
<td style="text-align:center">418</td>
<td style="text-align:center">3095</td>
<td style="text-align:center">3296</td>
<td style="text-align:center">3345</td>
<td style="text-align:center">1011.16</td>
<td style="text-align:center">1117</td>
<td style="text-align:center">180.06</td>
<td style="text-align:center">0.85</td>
<td style="text-align:center">Fair</td>
</tr>
</tbody>
</table>
<h4 id="hints-for-tuning">Hints for tuning</h4>
<p>Very often performance tests reveal that access to database is a bottleneck. In second (scalatra) of above cases we can observe it quite soon.</p>
<p>First natural approach is to increase the database connection pool what should suffice for a while. Increasing timeout is highly undesirable because it would only slow everything down. Another practise (this time expensive) is to set a database cluster or/and queue updates and queries to database. But any of that moves requires expertise knowledge in every of touched areas (like distributed setup of databases and applications). But that is not the case here, tests are being run on defaults.</p>
<hr>

    </article>

    


  <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hanskoff" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


  </div>
</div>

  </main>
  <footer class="flex flex-none justify-center">
    <section class="flex flex-col md:flex-row mx-2 md:mx-0 gap-2 md:gap-0 justify-between w-full max-w-4xl lg:max-w-5xl py-6 text-slate-500 dark:text-slate-300">
  <div class="flex flex-row">
    
  
  
  
  
  
  
  
  
  
  
  


  </div>
  <div class="grow"></div>
  <div class="flex flex-row">
    <i class="h-6 w-6 flex-none"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
   <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
   <path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"></path>
   <path d="M14 9.75a3.016 3.016 0 0 0 -4.163 .173a2.993 2.993 0 0 0 0 4.154a3.016 3.016 0 0 0 4.163 .173"></path>
</svg>
</i> 2014 - 2024 Jan
    
  </div>
  
</section>

  </footer>
  <script src="/main.min.c6372b6836971865bd94bfde974748aca8415824a2facab6ccd66a87384bfacb.js"></script>

<div class="hidden top-1 right-1" id="code-copy">
  <i class="h-6 w-6 block">
    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copy" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" />
  <path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" />
</svg>

  </i>
</div>
<div class="hidden top-1 right-1" id="code-copy-done">
  <i class="h-6 w-6 block">
    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-check" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M5 12l5 5l10 -10" />
</svg>

  </i>
</div><script src="/code-copy.min.4be95a7068ec721962fd0df64ce1c8673df8035fde465874f1e6e67e2aac7f71.js"></script>





</body>
</html>
